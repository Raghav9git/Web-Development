<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Analytics | SafeNet</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="icon" href="favicon.png">
<meta name="theme-color" content="#0b0b14">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:"Segoe UI",sans-serif}
body{
  background:
    radial-gradient(circle at 20% 20%, #2b1b5a 0%, transparent 40%),
    radial-gradient(circle at 80% 10%, #3b1d6b 0%, transparent 45%),
    linear-gradient(180deg, #060814, #0b1020 60%, #05060f);
  color:#fff;
  padding-top:90px;
}

/* NAVBAR */
.navbar{
  position:fixed;top:0;width:100%;
  padding:14px 24px;
  background:rgba(11,11,20,.4);
  backdrop-filter:blur(10px);
  display:flex;justify-content:space-between;align-items:center;
  z-index:1000;
}
.navbar h2{font-weight:600}
.navbar select{
  background:#1e1b4b;color:#fff;border:none;
  padding:6px 10px;border-radius:8px;
}

/* MAIN */
main{padding:30px 6%}

/* FILTERS */
.filters{
  display:flex;gap:16px;flex-wrap:wrap;
  margin-bottom:20px;
}
.filters input,.filters select,.filters button{
  background:#1e1b4b;
  color:#fff;
  border:none;
  padding:10px 14px;
  border-radius:10px;
}
.filters button{
  background:#a855f7;
  cursor:pointer;
}

/* GRID */
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(300px,1fr));
  gap:24px;
}

/* CARD */
.card{
  background:rgba(255,255,255,.06);
  border-radius:16px;
  padding:20px;
}

/* MAP */
#map{height:300px;border-radius:14px}

/* TABLE */
table{width:100%;border-collapse:collapse;font-size:.9rem}
th,td{padding:10px;border-bottom:1px solid rgba(255,255,255,.1)}
th{color:#d8b4fe;text-align:left}

/* AI BOX */
.ai-box{
  background:linear-gradient(135deg,#7c3aed,#a855f7);
  border-radius:16px;
  padding:20px;
}
.ai-box h3{margin-bottom:10px}

/* EXPORT */
.export{
  display:flex;
  gap:14px;
  margin-top:14px;
}
.export button{
  flex:1;
  padding:10px;
  border:none;
  border-radius:10px;
  background:#1e1b4b;
  color:#fff;
  cursor:pointer;
}
</style>
</head>

<body>

<!-- NAVBAR -->
<div class="navbar">
  <h2>SafeNet Analytics</h2>
  <div>
    <a class="active" href="report.html">Report</a>
    <a href="home.html">Home</a>
    <a href="profile.html">Profile</a>
    <a href="settings.html">Settings</a>
    <a href="analytics.html">Analytics</a>
    <a href="your safety.html">Your Safety</a>
    <a href="want to help.html">Want To Help?</a>
    <a href="community response.html">Community Response</a>
    <a href="services.html">Services</a>
    <a href="view-incidents.html">View Incidents</a>
  </div>
</div>

<main>

<!-- FILTERS -->
<div class="filters">
  <input type="date">
  <input type="date">
  <select id="zoneFilter">
    <option value="All">All Zones</option>
    <option value="Zone A">Zone A</option>
    <option value="Zone B">Zone B</option>
    <option value="Zone C">Zone C</option>
  </select>
  <button onclick="applyFilter()">Apply Filter</button>
</div>

<div class="grid">

  <!-- MAP -->
  <div class="card">
    <h3>Incident Hotspots (Map Linked)</h3>
    <div id="map"></div>
  </div>

  <!-- INCIDENT TYPE -->
  <div class="card">
    <h3>Incident Distribution</h3>
    <canvas id="typeChart"></canvas>
  </div>

  <!-- RESPONSE -->
  <div class="card responder-only">
    <h3>Average Response Time</h3>
    <canvas id="responseChart"></canvas>
  </div>

  <!-- TABLE -->
  <div class="card admin-only">
    <h3>Frequent Incident Zones</h3>
    <table>
      <tr><th>Zone</th><th>Type</th><th>Count</th></tr>
      <tr><td>Zone A</td><td>Accident</td><td>214</td></tr>
      <tr><td>Zone B</td><td>Medical</td><td>187</td></tr>
      <tr><td>Zone C</td><td>Fire</td><td>143</td></tr>
    </table>
  </div>

  <!-- AI -->
  <div class="card ai-box">
    <h3>AI Risk Prediction (Simulated)</h3>
    <p><b>Risk Level:</b> <span id="risk">HIGH</span></p>
    <p style="margin-top:8px">
      Based on rising incident trends and hotspot density, Zone A is predicted to face increased risk in the next 24 hours.
    </p>
  </div>

</div>

<!-- EXPORT -->
<div class="export">
  <button onclick="exportCSV()">Export CSV</button>
  <button onclick="window.print()">Export PDF</button>
</div>

</main>

<script>
/* CHARTS */
new Chart(typeChart,{
  type:"doughnut",
  data:{
    labels:["Accident","Medical","Fire","Flood"],
    datasets:[{data:[420,310,190,150],
    backgroundColor:["#a855f7","#6366f1","#ec4899","#38bdf8"]}]
  }
});

new Chart(responseChart,{
  type:"bar",
  data:{
    labels:["Medical","Fire","Accident"],
    datasets:[{data:[6.2,8.1,7.4],backgroundColor:"#a855f7"}]
  }
});

/* MAP */
const map=L.map("map").setView([19.076,72.877],11);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);
[
 {z:"Zone A",c:[19.1,72.85]},
 {z:"Zone B",c:[19.07,72.9]},
 {z:"Zone C",c:[19.02,72.88]}
].forEach(h=>{
  L.marker(h.c).addTo(map)
   .bindPopup(`<b>${h.z}</b><br>High activity area`);
});

/* ROLE BASED VIEW */
const roleSelect=document.getElementById("roleSelect");
function applyRole(){
  document.querySelectorAll(".admin-only")
    .forEach(e=>e.style.display=roleSelect.value==="admin"?"block":"none");
}
roleSelect.onchange=applyRole;
applyRole();

/* FILTER */
function applyFilter(){
  document.getElementById("risk").innerText=
    Math.random()>0.5?"HIGH":"MEDIUM";
}

/* CSV EXPORT */
function exportCSV(){
  let csv="Zone,Type,Count\nZone A,Accident,214\nZone B,Medical,187";
  let blob=new Blob([csv],{type:"text/csv"});
  let a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="analytics.csv";
  a.click();
}
</script>

</body>
</html>
